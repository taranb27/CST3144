<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
    <!-- <script src="subjects.js"></script> -->

    <title>Document</title>
</head>
<body>
    <div id="app">
        <h1 style="font-size: 28px; text-align: center; padding: 2%;">{{title1}}</h1>
        <!-- Checkout Button -->
        <button v-on:click="showCheckout" class="btn btn-info" style="margin-left: 10px; margin-bottom: 20px;">
            {{countItemInCart}}
            <span class="fa fa-cart-plus"></span>
            Checkout
        </button>

        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <main>
                <div v-if="showSubject">

                    <div style="display: flex; flex-wrap: wrap;">
                        <div v-for="subject in courses" class="card" style="width: 250px; margin: 10px;">
                            <p class="card-text" style="padding: 0; margin: 0; margin-left: 10px; margin-top: 10px;;">Subject: {{subject.Subject}}</p>
                            <p class="card-text" style="padding: 0; margin: 0; margin-left: 10px;">Location: {{subject.Location}}</p>
                            <p class="card-text" style="padding: 0; margin: 0; margin-left: 10px;">Price: {{subject.Price}}</p>
                            <p class="card-text" style="margin-left: 10px;">Spaces: {{subject.Spaces}}</p>

                            <!-- Add to Cart Button -->
                            <button class="btn btn-primary" style="margin-bottom: 10px; margin-left: 10px; margin-right: 10px;" v-on:click="addItemToCart(subject)" v-if="CanAddItemToCart(subject)">Add to Cart</button>
                            <div v-else>
                                <button class="btn btn-secondary" disabled>Add to Cart</button>
                                <span v-if="subject.Spaces === CartCount(subject._id)">Housefull!</span>
                                <span v-else-if="itemsLeft < 4">Only {{itemsLeft}} left!</span>
                                <span v-else>Buy Now!</span>
                            </div>
                        </div>
                    </div>

                </div>

                <div v-else>
                    <h1 style="font-size: 28px; text-align: center; padding: 2%;">{{title2}}</h1>

                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <form style="width: 500px;">
                            <p><input v-model.trim="checkout.firstName" class="form-control" placeholder="First Name"></p>
                            <p><input v-model.trim="checkout.lastName" class="form-control" placeholder="Last Name"></p>
                            <p><input v-model.trim="checkout.email" class="form-control" type="email" placeholder="Email Address"></p>
                            <p><input v-model.trim="checkout.address" class="form-control" placeholder="Home address"></p>
                            <button v-on:click="submitForm" type="button" class="btn btn-success">Success</button>
                        </form>
                    </div>


                </div>

            </main>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script>
        let webstore = new Vue({
            el: '#app',
            data: {
                title1: "After School Classes",
                title2: "Welcome to the checkout page",
                showSubject: true,
                courses: [],  // Array to hold fetched courses
                cart: [],
                checkout: {
                    firstName: '',
                    lastName: '',
                    email: '',
                    address: ''
                },
            },
            methods: {
                fetchCourses() {
                    fetch('http://localhost:8080/courses')  
                        .then(response => response.json())
                        .then(data => {
                            this.courses = data;
                        })
                        .catch(error => {
                            console.error('error fetching courses:', error)
                        })
                },
                
                addItemToCart(course) {
                    this.cart.push(course._id);
                },

                CanAddItemToCart(course) {
                    return course.Spaces > this.CartCount(course._id);
                },

                CartCount(id) {
                    return this.cart.filter(item => item === id).length; 
                },

                showCheckout() {
                    this.showSubject = !this.showSubject;
                },

                submitForm() {
                    if (
                        this.checkout.firstName &&
                        this.checkout.lastName &&
                        this.checkout.email &&
                        this.checkout.address             
                    ) {
                        alert('Form Submitted');
                    } else {
                        Swal.fire({
                            title: 'Form Incomplete!',
                            text: 'Please fill out the form',
                            icon: 'error',
                        });
                    }
                },
            },
            created() {
                this.fetchCourses();  
            },
            computed: {
                countItemInCart() {
                    return this.cart.length || "";
                },

                itemsLeft() {
                    return this.subject.Spaces - this.countItemInCart
                }
            }
        });

    </script>
</body>
</html>